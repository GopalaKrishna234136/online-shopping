<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Complete Online Shop</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }
    
    * {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
    }

    .product-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .product-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
    }

    .badge {
      animation: pop 0.3s ease;
    }

    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      padding: 16px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      animation: fadeIn 0.2s ease;
      overflow-y: auto;
      padding: 20px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      animation: slideUp 0.3s ease;
      max-height: 90%;
      overflow-y: auto;
    }

    @keyframes slideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .tab-button {
      transition: all 0.2s ease;
    }

    .spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 0.8s linear infinite;
      display: inline-block;
      margin-left: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body><!-- Navigation -->
  <nav id="navbar" style="background: #1a1a2e; color: #ffffff; padding: 20px 0; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
   <div style="max-width: 1200px; margin: 0 auto; padding: 0 24px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
    <h1 id="store-name" style="margin: 0; font-size: 28px; font-weight: 700;">ShopHub Pro</h1>
    <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;"><button id="account-button" style="background: none; border: 2px solid #ffffff; color: white; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;"> üë§ <span id="user-display">Guest</span> </button> <button id="wishlist-button" style="background: none; border: 2px solid #ffffff; color: white; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; position: relative; transition: all 0.2s;"> ‚ù§Ô∏è Wishlist (<span id="wishlist-count">0</span>) </button> <button id="cart-button" style="background: #6c63ff; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; position: relative; transition: background 0.2s;"> üõí Cart (<span id="cart-count">0</span>) </button>
    </div>
   </div>
  </nav><!-- Hero Section -->
  <section id="hero" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 80px 24px; text-align: center;">
   <h2 id="hero-title" style="font-size: 48px; font-weight: 800; margin: 0 0 16px 0;">Your Complete Shopping Experience</h2>
   <p id="hero-subtitle" style="font-size: 20px; margin: 0 0 32px 0; opacity: 0.95;">Shop, save favorites, and track your orders all in one place</p><button id="cta-button" style="background: #ffffff; color: #667eea; border: none; padding: 16px 40px; border-radius: 8px; font-size: 18px; font-weight: 700; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 12px rgba(0,0,0,0.2);"> Start Shopping </button>
  </section><!-- Main Content -->
  <main style="max-width: 1200px; margin: 60px auto; padding: 0 24px;">
   <h2 style="font-size: 36px; font-weight: 700; margin: 0 0 40px 0; text-align: center; color: #1a1a2e;">Featured Products</h2>
   <div id="products-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 32px;"><!-- Products will be inserted here -->
   </div>
  </main><!-- Modals Container -->
  <div id="modals-container"></div><!-- Toast Container -->
  <div id="toast-container"></div>
  <script>
    const defaultConfig = {
      background_color: "#f5f5f7",
      surface_color: "#ffffff",
      text_color: "#1a1a2e",
      primary_action_color: "#6c63ff",
      secondary_action_color: "#667eea",
      store_name: "ShopHub Pro",
      hero_title: "Your Complete Shopping Experience",
      hero_subtitle: "Shop, save favorites, and track your orders all in one place",
      cta_button_text: "Start Shopping",
      font_family: "inherit",
      font_size: 16
    };

    const products = [
      { id: 1, name: "Wireless Headphones", price: 89.99, image: "üéß", category: "Electronics", description: "Premium sound quality" },
      { id: 2, name: "Smart Watch", price: 199.99, image: "‚åö", category: "Electronics", description: "Track your fitness" },
      { id: 3, name: "Laptop Backpack", price: 49.99, image: "üéí", category: "Accessories", description: "Durable and stylish" },
      { id: 4, name: "Coffee Maker", price: 79.99, image: "‚òï", category: "Home", description: "Perfect brew every time" },
      { id: 5, name: "Running Shoes", price: 129.99, image: "üëü", category: "Fashion", description: "Comfort meets performance" },
      { id: 6, name: "Sunglasses", price: 39.99, image: "üï∂Ô∏è", category: "Fashion", description: "UV protection included" },
      { id: 7, name: "Portable Speaker", price: 59.99, image: "üîä", category: "Electronics", description: "Take music anywhere" },
      { id: 8, name: "Plant Pot", price: 24.99, image: "ü™¥", category: "Home", description: "Eco-friendly design" }
    ];

    let cart = [];
    let wishlist = [];
    let currentUser = null;
    let allData = [];

    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        renderOrderHistory();
      }
    };

    async function initializeApp() {
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        console.error("Failed to initialize data SDK");
      }
    }

    async function onConfigChange(config) {
      const baseFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = `-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif`;
      const fontFamily = `${baseFont}, ${baseFontStack}`;
      const baseSize = config.font_size || defaultConfig.font_size;

      document.body.style.fontFamily = fontFamily;
      document.body.style.background = config.background_color || defaultConfig.background_color;

      const navbar = document.getElementById('navbar');
      navbar.style.background = config.text_color || defaultConfig.text_color;
      navbar.style.color = config.surface_color || defaultConfig.surface_color;

      const storeNameEl = document.getElementById('store-name');
      storeNameEl.textContent = config.store_name || defaultConfig.store_name;
      storeNameEl.style.fontSize = `${baseSize * 1.75}px`;

      const accountButton = document.getElementById('account-button');
      accountButton.style.fontSize = `${baseSize * 0.875}px`;
      accountButton.style.borderColor = config.surface_color || defaultConfig.surface_color;
      accountButton.style.color = config.surface_color || defaultConfig.surface_color;

      const wishlistButton = document.getElementById('wishlist-button');
      wishlistButton.style.fontSize = `${baseSize * 0.875}px`;
      wishlistButton.style.borderColor = config.surface_color || defaultConfig.surface_color;
      wishlistButton.style.color = config.surface_color || defaultConfig.surface_color;

      const cartButton = document.getElementById('cart-button');
      cartButton.style.background = config.primary_action_color || defaultConfig.primary_action_color;
      cartButton.style.fontSize = `${baseSize}px`;

      const hero = document.getElementById('hero');
      hero.style.background = `linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color} 0%, ${config.secondary_action_color || defaultConfig.secondary_action_color} 100%)`;

      const heroTitle = document.getElementById('hero-title');
      heroTitle.textContent = config.hero_title || defaultConfig.hero_title;
      heroTitle.style.fontSize = `${baseSize * 3}px`;

      const heroSubtitle = document.getElementById('hero-subtitle');
      heroSubtitle.textContent = config.hero_subtitle || defaultConfig.hero_subtitle;
      heroSubtitle.style.fontSize = `${baseSize * 1.25}px`;

      const ctaButton = document.getElementById('cta-button');
      ctaButton.textContent = config.cta_button_text || defaultConfig.cta_button_text;
      ctaButton.style.background = config.surface_color || defaultConfig.surface_color;
      ctaButton.style.color = config.primary_action_color || defaultConfig.primary_action_color;
      ctaButton.style.fontSize = `${baseSize * 1.125}px`;

      renderProducts();
    }

    function renderProducts() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const grid = document.getElementById('products-grid');
      grid.innerHTML = '';

      products.forEach(product => {
        const isInWishlist = wishlist.some(item => item.id === product.id);
        
        const card = document.createElement('div');
        card.className = 'product-card';
        card.style.background = config.surface_color || defaultConfig.surface_color;
        card.style.borderRadius = '12px';
        card.style.padding = '24px';
        card.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
        card.style.position = 'relative';

        card.innerHTML = `
          <button class="wishlist-toggle" data-id="${product.id}" style="position: absolute; top: 16px; right: 16px; background: none; border: none; font-size: ${baseSize * 1.5}px; cursor: pointer; transition: transform 0.2s;">
            ${isInWishlist ? '‚ù§Ô∏è' : 'ü§ç'}
          </button>
          <div style="font-size: ${baseSize * 4}px; text-align: center; margin-bottom: 16px;">${product.image}</div>
          <h3 style="font-size: ${baseSize * 1.25}px; font-weight: 600; margin: 0 0 8px 0; color: ${config.text_color || defaultConfig.text_color};">${product.name}</h3>
          <p style="font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7; margin: 0 0 4px 0;">${product.category}</p>
          <p style="font-size: ${baseSize * 0.8}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.6; margin: 0 0 12px 0;">${product.description}</p>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px;">
            <span style="font-size: ${baseSize * 1.5}px; font-weight: 700; color: ${config.primary_action_color || defaultConfig.primary_action_color};">$${product.price}</span>
            <button class="add-to-cart-btn" data-id="${product.id}" style="background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-size: ${baseSize * 0.875}px; font-weight: 600; cursor: pointer; transition: opacity 0.2s;">
              Add to Cart
            </button>
          </div>
        `;

        grid.appendChild(card);
      });

      document.querySelectorAll('.wishlist-toggle').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const productId = parseInt(btn.dataset.id);
          toggleWishlist(productId);
        });

        btn.addEventListener('mouseenter', function() {
          this.style.transform = 'scale(1.2)';
        });

        btn.addEventListener('mouseleave', function() {
          this.style.transform = 'scale(1)';
        });
      });

      document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const productId = parseInt(btn.dataset.id);
          addToCart(productId);
        });

        btn.addEventListener('mouseenter', function() {
          this.style.opacity = '0.85';
        });

        btn.addEventListener('mouseleave', function() {
          this.style.opacity = '1';
        });
      });
    }

    function toggleWishlist(productId) {
      const product = products.find(p => p.id === productId);
      const existingIndex = wishlist.findIndex(item => item.id === productId);

      if (existingIndex > -1) {
        wishlist.splice(existingIndex, 1);
        showToast(`${product.name} removed from wishlist`);
      } else {
        wishlist.push(product);
        showToast(`${product.name} added to wishlist!`);
      }

      updateWishlistCount();
      renderProducts();
    }

    function updateWishlistCount() {
      const countEl = document.getElementById('wishlist-count');
      countEl.textContent = wishlist.length;
      countEl.parentElement.classList.add('badge');
      setTimeout(() => countEl.parentElement.classList.remove('badge'), 300);
    }

    function addToCart(productId) {
      const product = products.find(p => p.id === productId);
      const existingItem = cart.find(item => item.id === productId);

      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({ ...product, quantity: 1 });
      }

      updateCartCount();
      showToast(`${product.name} added to cart!`);
    }

    function updateCartCount() {
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      const countEl = document.getElementById('cart-count');
      countEl.textContent = totalItems;
      countEl.parentElement.classList.add('badge');
      setTimeout(() => countEl.parentElement.classList.remove('badge'), 300);
    }

    function showToast(message) {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.style.background = config.primary_action_color || defaultConfig.primary_action_color;
      toast.style.color = config.surface_color || defaultConfig.surface_color;
      toast.style.fontSize = `${baseSize}px`;
      toast.textContent = message;

      container.appendChild(toast);

      setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s ease reverse';
        setTimeout(() => toast.remove(), 300);
      }, 2000);
    }

    function openCart() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const modal = document.getElementById('modals-container');
      
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

      let cartHTML = `
        <div class="modal-overlay">
          <div class="modal-content" style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 16px; padding: 32px; max-width: 600px; width: 90%;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <h2 style="margin: 0; font-size: ${baseSize * 1.875}px; color: ${config.text_color || defaultConfig.text_color};">Shopping Cart</h2>
              <button class="close-modal" style="background: none; border: none; font-size: ${baseSize * 1.5}px; cursor: pointer; color: ${config.text_color || defaultConfig.text_color};">‚úï</button>
            </div>
      `;

      if (cart.length === 0) {
        cartHTML += `<p style="text-align: center; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7; font-size: ${baseSize}px; padding: 40px 0;">Your cart is empty</p>`;
      } else {
        cart.forEach(item => {
          cartHTML += `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; border-bottom: 1px solid rgba(0,0,0,0.1); margin-bottom: 12px;">
              <div style="display: flex; align-items: center; gap: 16px; flex: 1;">
                <span style="font-size: ${baseSize * 2}px;">${item.image}</span>
                <div>
                  <h4 style="margin: 0 0 4px 0; font-size: ${baseSize * 1.125}px; color: ${config.text_color || defaultConfig.text_color};">${item.name}</h4>
                  <p style="margin: 0; font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">$${item.price}</p>
                </div>
              </div>
              <div style="display: flex; align-items: center; gap: 12px;">
                <button class="qty-btn" data-id="${item.id}" data-action="decrease" style="background: ${config.surface_color || defaultConfig.surface_color}; border: 2px solid ${config.primary_action_color || defaultConfig.primary_action_color}; color: ${config.primary_action_color || defaultConfig.primary_action_color}; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; font-size: ${baseSize}px; font-weight: 700;">-</button>
                <span style="font-size: ${baseSize}px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">${item.quantity}</span>
                <button class="qty-btn" data-id="${item.id}" data-action="increase" style="background: ${config.primary_action_color || defaultConfig.primary_action_color}; border: none; color: white; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; font-size: ${baseSize}px; font-weight: 700;">+</button>
              </div>
            </div>
          `;
        });

        cartHTML += `
          <div style="margin-top: 24px; padding-top: 24px; border-top: 2px solid rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
              <span style="font-size: ${baseSize * 1.25}px; font-weight: 700; color: ${config.text_color || defaultConfig.text_color};">Total:</span>
              <span style="font-size: ${baseSize * 1.5}px; font-weight: 700; color: ${config.primary_action_color || defaultConfig.primary_action_color};">$${total.toFixed(2)}</span>
            </div>
            <button class="checkout-btn" style="width: 100%; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; border: none; padding: 16px; border-radius: 8px; font-size: ${baseSize * 1.125}px; font-weight: 700; cursor: pointer; transition: opacity 0.2s;">
              Proceed to Checkout
            </button>
          </div>
        `;
      }

      cartHTML += `
          </div>
        </div>
      `;

      modal.innerHTML = cartHTML;

      modal.querySelector('.close-modal').addEventListener('click', closeModal);
      
      const checkoutBtn = modal.querySelector('.checkout-btn');
      if (checkoutBtn) {
        checkoutBtn.addEventListener('click', () => {
          closeModal();
          openCheckout();
        });

        checkoutBtn.addEventListener('mouseenter', function() {
          this.style.opacity = '0.85';
        });

        checkoutBtn.addEventListener('mouseleave', function() {
          this.style.opacity = '1';
        });
      }

      modal.querySelectorAll('.qty-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const productId = parseInt(btn.dataset.id);
          const action = btn.dataset.action;
          updateQuantity(productId, action);
        });

        btn.addEventListener('mouseenter', function() {
          this.style.opacity = '0.7';
        });

        btn.addEventListener('mouseleave', function() {
          this.style.opacity = '1';
        });
      });

      modal.querySelector('.modal-overlay').addEventListener('click', (e) => {
        if (e.target.classList.contains('modal-overlay')) {
          closeModal();
        }
      });
    }

    function updateQuantity(productId, action) {
      const item = cart.find(i => i.id === productId);
      
      if (action === 'increase') {
        item.quantity += 1;
      } else if (action === 'decrease') {
        item.quantity -= 1;
        if (item.quantity === 0) {
          cart = cart.filter(i => i.id !== productId);
        }
      }

      updateCartCount();
      openCart();
    }

    function openCheckout() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const modal = document.getElementById('modals-container');
      
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

      let checkoutHTML = `
        <div class="modal-overlay">
          <div class="modal-content" style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 16px; padding: 32px; max-width: 600px; width: 90%;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <h2 style="margin: 0; font-size: ${baseSize * 1.875}px; color: ${config.text_color || defaultConfig.text_color};">Checkout</h2>
              <button class="close-modal" style="background: none; border: none; font-size: ${baseSize * 1.5}px; cursor: pointer; color: ${config.text_color || defaultConfig.text_color};">‚úï</button>
            </div>

            <form id="checkout-form" style="display: flex; flex-direction: column; gap: 20px;">
              <div>
                <label for="customer-name" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color};">Full Name</label>
                <input type="text" id="customer-name" required style="width: 100%; padding: 12px; border: 2px solid rgba(0,0,0,0.1); border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color || defaultConfig.text_color};">
              </div>

              <div>
                <label for="customer-email" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color};">Email Address</label>
                <input type="email" id="customer-email" required style="width: 100%; padding: 12px; border: 2px solid rgba(0,0,0,0.1); border-radius: 8px; font-size: ${baseSize}px; color: ${config.text_color || defaultConfig.text_color};">
              </div>

              <div>
                <label for="shipping-address" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color};">Shipping Address</label>
                <textarea id="shipping-address" required rows="3" style="width: 100%; padding: 12px; border: 2px solid rgba(0,0,0,0.1); border-radius: 8px; font-size: ${baseSize}px; resize: vertical; color: ${config.text_color || defaultConfig.text_color};"></textarea>
              </div>

              <div style="background: ${config.background_color || defaultConfig.background_color}; padding: 20px; border-radius: 8px; margin-top: 12px;">
                <h3 style="margin: 0 0 16px 0; font-size: ${baseSize * 1.125}px; color: ${config.text_color || defaultConfig.text_color};">Order Summary</h3>
                ${cart.map(item => `
                  <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color};">
                    <span>${item.name} √ó ${item.quantity}</span>
                    <span>$${(item.price * item.quantity).toFixed(2)}</span>
                  </div>
                `).join('')}
                <div style="border-top: 2px solid rgba(0,0,0,0.1); margin-top: 12px; padding-top: 12px; display: flex; justify-content: space-between; font-weight: 700; font-size: ${baseSize * 1.125}px; color: ${config.text_color || defaultConfig.text_color};">
                  <span>Total:</span>
                  <span style="color: ${config.primary_action_color || defaultConfig.primary_action_color};">$${total.toFixed(2)}</span>
                </div>
              </div>

              <button type="submit" id="place-order-btn" style="width: 100%; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; border: none; padding: 16px; border-radius: 8px; font-size: ${baseSize * 1.125}px; font-weight: 700; cursor: pointer; transition: opacity 0.2s;">
                Place Order
              </button>
            </form>
          </div>
        </div>
      `;

      modal.innerHTML = checkoutHTML;

      const form = document.getElementById('checkout-form');
      const submitBtn = document.getElementById('place-order-btn');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        submitBtn.disabled = true;
        submitBtn.innerHTML = 'Processing<span class="spinner"></span>';

        const name = document.getElementById('customer-name').value;
        const email = document.getElementById('customer-email').value;
        const address = document.getElementById('shipping-address').value;

        const orderCount = allData.filter(d => d.type === 'order').length;
        
        if (orderCount >= 999) {
          showToast('Order limit reached (999). Please contact support.');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Place Order';
          return;
        }

        const orderData = {
          id: `order-${Date.now()}`,
          type: 'order',
          user_name: name,
          user_email: email,
          order_date: new Date().toISOString(),
          order_total: total,
          shipping_address: address,
          status: 'Processing'
        };

        const createResult = await window.dataSdk.create(orderData);
        
        if (createResult.isOk) {
          for (const item of cart) {
            const itemCount = allData.filter(d => d.type === 'order_item').length;
            if (itemCount < 999) {
              await window.dataSdk.create({
                id: `item-${Date.now()}-${item.id}`,
                type: 'order_item',
                user_email: email,
                product_id: item.id,
                product_name: item.name,
                product_price: item.price,
                quantity: item.quantity,
                order_date: orderData.order_date
              });
            }
          }

          cart = [];
          updateCartCount();
          closeModal();
          showToast('Order placed successfully! Check your account for details.');
          
          if (!currentUser) {
            currentUser = { name, email };
            updateUserDisplay();
          }
        } else {
          showToast('Order failed. Please try again.');
        }

        submitBtn.disabled = false;
        submitBtn.textContent = 'Place Order';
      });

      submitBtn.addEventListener('mouseenter', function() {
        if (!this.disabled) this.style.opacity = '0.85';
      });

      submitBtn.addEventListener('mouseleave', function() {
        this.style.opacity = '1';
      });

      modal.querySelector('.close-modal').addEventListener('click', closeModal);
      modal.querySelector('.modal-overlay').addEventListener('click', (e) => {
        if (e.target.classList.contains('modal-overlay')) {
          closeModal();
        }
      });
    }

    function openWishlist() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const modal = document.getElementById('modals-container');

      let wishlistHTML = `
        <div class="modal-overlay">
          <div class="modal-content" style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 16px; padding: 32px; max-width: 600px; width: 90%;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <h2 style="margin: 0; font-size: ${baseSize * 1.875}px; color: ${config.text_color || defaultConfig.text_color};">My Wishlist</h2>
              <button class="close-modal" style="background: none; border: none; font-size: ${baseSize * 1.5}px; cursor: pointer; color: ${config.text_color || defaultConfig.text_color};">‚úï</button>
            </div>
      `;

      if (wishlist.length === 0) {
        wishlistHTML += `<p style="text-align: center; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7; font-size: ${baseSize}px; padding: 40px 0;">Your wishlist is empty</p>`;
      } else {
        wishlist.forEach(item => {
          wishlistHTML += `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; border-bottom: 1px solid rgba(0,0,0,0.1); margin-bottom: 12px;">
              <div style="display: flex; align-items: center; gap: 16px; flex: 1;">
                <span style="font-size: ${baseSize * 2}px;">${item.image}</span>
                <div>
                  <h4 style="margin: 0 0 4px 0; font-size: ${baseSize * 1.125}px; color: ${config.text_color || defaultConfig.text_color};">${item.name}</h4>
                  <p style="margin: 0; font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">$${item.price}</p>
                </div>
              </div>
              <div style="display: flex; gap: 8px;">
                <button class="add-from-wishlist" data-id="${item.id}" style="background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: ${baseSize * 0.875}px; cursor: pointer;">
                  Add to Cart
                </button>
                <button class="remove-from-wishlist" data-id="${item.id}" style="background: none; border: 2px solid ${config.text_color || defaultConfig.text_color}; color: ${config.text_color || defaultConfig.text_color}; padding: 8px 16px; border-radius: 6px; font-size: ${baseSize * 0.875}px; cursor: pointer;">
                  Remove
                </button>
              </div>
            </div>
          `;
        });
      }

      wishlistHTML += `
          </div>
        </div>
      `;

      modal.innerHTML = wishlistHTML;

      modal.querySelectorAll('.add-from-wishlist').forEach(btn => {
        btn.addEventListener('click', () => {
          const productId = parseInt(btn.dataset.id);
          addToCart(productId);
        });
      });

      modal.querySelectorAll('.remove-from-wishlist').forEach(btn => {
        btn.addEventListener('click', () => {
          const productId = parseInt(btn.dataset.id);
          toggleWishlist(productId);
          openWishlist();
        });
      });

      modal.querySelector('.close-modal').addEventListener('click', closeModal);
      modal.querySelector('.modal-overlay').addEventListener('click', (e) => {
        if (e.target.classList.contains('modal-overlay')) {
          closeModal();
        }
      });
    }

    function openAccount() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const modal = document.getElementById('modals-container');

      let accountHTML = `
        <div class="modal-overlay">
          <div class="modal-content" style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 16px; padding: 32px; max-width: 700px; width: 90%;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <h2 style="margin: 0; font-size: ${baseSize * 1.875}px; color: ${config.text_color || defaultConfig.text_color};">My Account</h2>
              <button class="close-modal" style="background: none; border: none; font-size: ${baseSize * 1.5}px; cursor: pointer; color: ${config.text_color || defaultConfig.text_color};">‚úï</button>
            </div>

            <div style="display: flex; gap: 8px; margin-bottom: 24px; border-bottom: 2px solid rgba(0,0,0,0.1);">
              <button class="tab-button active" data-tab="profile" style="background: none; border: none; padding: 12px 24px; font-size: ${baseSize}px; font-weight: 600; cursor: pointer; border-bottom: 3px solid ${config.primary_action_color || defaultConfig.primary_action_color}; color: ${config.primary_action_color || defaultConfig.primary_action_color};">
                Profile
              </button>
              <button class="tab-button" data-tab="orders" style="background: none; border: none; padding: 12px 24px; font-size: ${baseSize}px; font-weight: 600; cursor: pointer; border-bottom: 3px solid transparent; color: ${config.text_color || defaultConfig.text_color};">
                Order History
              </button>
            </div>

            <div id="tab-content"></div>
          </div>
        </div>
      `;

      modal.innerHTML = accountHTML;

      const tabButtons = modal.querySelectorAll('.tab-button');
      tabButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          tabButtons.forEach(b => {
            b.style.borderBottom = '3px solid transparent';
            b.style.color = config.text_color || defaultConfig.text_color;
            b.classList.remove('active');
          });
          btn.style.borderBottom = `3px solid ${config.primary_action_color || defaultConfig.primary_action_color}`;
          btn.style.color = config.primary_action_color || defaultConfig.primary_action_color;
          btn.classList.add('active');
          
          const tab = btn.dataset.tab;
          if (tab === 'profile') {
            renderProfileTab();
          } else if (tab === 'orders') {
            renderOrdersTab();
          }
        });
      });

      renderProfileTab();

      modal.querySelector('.close-modal').addEventListener('click', closeModal);
      modal.querySelector('.modal-overlay').addEventListener('click', (e) => {
        if (e.target.classList.contains('modal-overlay')) {
          closeModal();
        }
      });
    }

    function renderProfileTab() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const tabContent = document.getElementById('tab-content');

      if (!currentUser) {
        const userOrders = allData.filter(d => d.type === 'order');
        if (userOrders.length > 0) {
          const lastOrder = userOrders[userOrders.length - 1];
          currentUser = { name: lastOrder.user_name, email: lastOrder.user_email };
          updateUserDisplay();
        }
      }

      let profileHTML = `
        <div style="padding: 20px;">
          ${currentUser ? `
            <div style="text-align: center; margin-bottom: 24px;">
              <div style="width: 80px; height: 80px; border-radius: 50%; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; display: flex; align-items: center; justify-content: center; font-size: ${baseSize * 2.5}px; margin: 0 auto 16px; font-weight: 700;">
                ${currentUser.name.charAt(0).toUpperCase()}
              </div>
              <h3 style="margin: 0 0 8px 0; font-size: ${baseSize * 1.5}px; color: ${config.text_color || defaultConfig.text_color};">${currentUser.name}</h3>
              <p style="margin: 0; font-size: ${baseSize}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">${currentUser.email}</p>
            </div>

            <div style="background: ${config.background_color || defaultConfig.background_color}; padding: 20px; border-radius: 8px;">
              <h4 style="margin: 0 0 12px 0; font-size: ${baseSize * 1.125}px; color: ${config.text_color || defaultConfig.text_color};">Account Statistics</h4>
              <div style="display: flex; justify-content: space-around; gap: 16px;">
                <div style="text-align: center;">
                  <div style="font-size: ${baseSize * 2}px; font-weight: 700; color: ${config.primary_action_color || defaultConfig.primary_action_color};">${allData.filter(d => d.type === 'order' && d.user_email === currentUser.email).length}</div>
                  <div style="font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Total Orders</div>
                </div>
                <div style="text-align: center;">
                  <div style="font-size: ${baseSize * 2}px; font-weight: 700; color: ${config.primary_action_color || defaultConfig.primary_action_color};">${wishlist.length}</div>
                  <div style="font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Wishlist Items</div>
                </div>
              </div>
            </div>
          ` : `
            <p style="text-align: center; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7; font-size: ${baseSize}px;">Place an order to create your account profile</p>
          `}
        </div>
      `;

      tabContent.innerHTML = profileHTML;
    }

    function renderOrdersTab() {
      renderOrderHistory();
    }

    function renderOrderHistory() {
      const tabContent = document.getElementById('tab-content');
      if (!tabContent) return;

      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;

      const orders = allData.filter(d => d.type === 'order');
      
      if (!currentUser && orders.length > 0) {
        const lastOrder = orders[orders.length - 1];
        currentUser = { name: lastOrder.user_name, email: lastOrder.user_email };
        updateUserDisplay();
      }

      const userOrders = currentUser 
        ? orders.filter(o => o.user_email === currentUser.email).sort((a, b) => new Date(b.order_date) - new Date(a.order_date))
        : [];

      let ordersHTML = '<div style="padding: 20px;">';

      if (userOrders.length === 0) {
        ordersHTML += `<p style="text-align: center; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7; font-size: ${baseSize}px;">No orders yet</p>`;
      } else {
        userOrders.forEach(order => {
          const orderDate = new Date(order.order_date);
          const orderItems = allData.filter(d => 
            d.type === 'order_item' && 
            d.user_email === order.user_email &&
            d.order_date === order.order_date
          );

          ordersHTML += `
            <div style="background: ${config.background_color || defaultConfig.background_color}; padding: 20px; border-radius: 8px; margin-bottom: 16px;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <div>
                  <h4 style="margin: 0 0 4px 0; font-size: ${baseSize * 1.125}px; color: ${config.text_color || defaultConfig.text_color};">Order ${order.id.substring(6, 16)}</h4>
                  <p style="margin: 0; font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">${orderDate.toLocaleDateString()} at ${orderDate.toLocaleTimeString()}</p>
                </div>
                <div style="text-align: right;">
                  <div style="font-size: ${baseSize * 1.25}px; font-weight: 700; color: ${config.primary_action_color || defaultConfig.primary_action_color};">$${order.order_total.toFixed(2)}</div>
                  <div style="font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">${order.status}</div>
                </div>
              </div>
              ${orderItems.length > 0 ? `
                <div style="border-top: 1px solid rgba(0,0,0,0.1); padding-top: 12px; margin-top: 12px;">
                  ${orderItems.map(item => `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color};">
                      <span>${item.product_name} √ó ${item.quantity}</span>
                      <span>$${(item.product_price * item.quantity).toFixed(2)}</span>
                    </div>
                  `).join('')}
                </div>
              ` : ''}
              <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(0,0,0,0.1);">
                <p style="margin: 0; font-size: ${baseSize * 0.8}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;"><strong>Shipping to:</strong> ${order.shipping_address}</p>
              </div>
            </div>
          `;
        });
      }

      ordersHTML += '</div>';
      tabContent.innerHTML = ordersHTML;
    }

    function updateUserDisplay() {
      const userDisplay = document.getElementById('user-display');
      if (currentUser) {
        userDisplay.textContent = currentUser.name.split(' ')[0];
      } else {
        userDisplay.textContent = 'Guest';
      }
    }

    function closeModal() {
      document.getElementById('modals-container').innerHTML = '';
    }

    document.getElementById('cart-button').addEventListener('click', openCart);
    document.getElementById('wishlist-button').addEventListener('click', openWishlist);
    document.getElementById('account-button').addEventListener('click', openAccount);
    
    document.getElementById('cta-button').addEventListener('click', () => {
      document.getElementById('products-grid').scrollIntoView({ behavior: 'smooth' });
    });

    const cartButton = document.getElementById('cart-button');
    cartButton.addEventListener('mouseenter', function() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      this.style.background = config.secondary_action_color || defaultConfig.secondary_action_color;
    });

    cartButton.addEventListener('mouseleave', function() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      this.style.background = config.primary_action_color || defaultConfig.primary_action_color;
    });

    const wishlistButton = document.getElementById('wishlist-button');
    wishlistButton.addEventListener('mouseenter', function() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      this.style.background = config.primary_action_color || defaultConfig.primary_action_color;
      this.style.color = config.surface_color || defaultConfig.surface_color;
    });

    wishlistButton.addEventListener('mouseleave', function() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      this.style.background = 'none';
      this.style.color = config.surface_color || defaultConfig.surface_color;
    });

    const accountButton = document.getElementById('account-button');
    accountButton.addEventListener('mouseenter', function() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      this.style.background = config.primary_action_color || defaultConfig.primary_action_color;
      this.style.color = config.surface_color || defaultConfig.surface_color;
    });

    accountButton.addEventListener('mouseleave', function() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      this.style.background = 'none';
      this.style.color = config.surface_color || defaultConfig.surface_color;
    });

    const ctaButton = document.getElementById('cta-button');
    ctaButton.addEventListener('mouseenter', function() {
      this.style.transform = 'scale(1.05)';
    });

    ctaButton.addEventListener('mouseleave', function() {
      this.style.transform = 'scale(1)';
    });

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.surface_color || defaultConfig.surface_color,
              set: (value) => {
                config.surface_color = value;
                window.elementSdk.setConfig({ surface_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.primary_action_color || defaultConfig.primary_action_color,
              set: (value) => {
                config.primary_action_color = value;
                window.elementSdk.setConfig({ primary_action_color: value });
              }
            },
            {
              get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
              set: (value) => {
                config.secondary_action_color = value;
                window.elementSdk.setConfig({ secondary_action_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["store_name", config.store_name || defaultConfig.store_name],
          ["hero_title", config.hero_title || defaultConfig.hero_title],
          ["hero_subtitle", config.hero_subtitle || defaultConfig.hero_subtitle],
          ["cta_button_text", config.cta_button_text || defaultConfig.cta_button_text]
        ])
      });
    } else {
      onConfigChange(defaultConfig);
    }

    initializeApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a180aea97394055',t:'MTc2MzY0MjcwOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>